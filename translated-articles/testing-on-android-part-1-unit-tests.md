# Android上的测试（第一部分）：单元测试

我最近在做一些关于Android测试的研究。我刚接触这个课题；尽管自动测试（在很长时间里）被认为是不必要的，但是我渐渐的相信收益大于它所花费的时间 - 只要你用一种有效率的方式来测试。最后，我开始评估很多Android测试框架来看看哪一个看起来能节省最多时间。

我总结了我能找到的所有工具或服务，它们都列在一个电子表格文件里（如果有什么工具或服务我没有列出，请让我知道）。

除此之外，我将写一系列的博客来更详细的解释Android测试的不同部分：

* 第一部分： 单元测试

* 第二部分：功能测试

* 第三部分：其它测试工具

* 第四部分：测试服务

* 电子表格：[Android测试](http://goo.gl/XSUxoJ)

让我们从单元测试开始吧。


## 单元测试

只要是不包含Android代码，没有原因不能使用常规的Junit4测试对Android应用进行测试。

一般情况下你使用SDK的android.jar来编译项目，而它只包含运行时会抛出异常的存根方法（stubbed methods）。当你将你的APK文件上传到设备时，它会使用设备上这些存根(stubs)的实现。因此当你在IDE运行常规的单元测试时，你无法访问这些框架的实现（除了会收到一堆异常）。但如果你测试一些简单地功能而不触及Android本身，这并不要紧。

**优点：**

* 快速并且简单

**缺点：**

* 不能使用任何Android框架类

##Android测试框架

[Android测试框架](http://developer.android.com/tools/testing/testing_android.html)是Android里官方的单元测试方法。它将你的应用上传至设备，然后运行基于JUnit的测试套件。因为它运行在实际的操作系统上，你可以像在你的应用里一样使用Android框架，并且能进行一系列真实的测试。

表面上测试框架是单元测试，但是在执行测试前缓慢地编译、上传过程让整个测试变慢。另外，你需要确认你有一个连接的设备或者一个模拟器正在运行。因此，我会考虑在半常规测试里使用测试框架（例如当你推送一个新的提交时，或者每夜测试），但在活跃开发时使用它们会有困难。

**优点：**

* 能访问Android框架

**缺点：**

* 慢
* 需要连接的设备或者运行模拟器
* 使用JUnit 3（而不是新的JUnit 4）

## Robolectric

[Robolectric](http://robolectric.org)项目结合了单元测试的速度和访问Android框架的能力。它用模拟类（mocked classes）实现了所有的存根（stubs）。

试过它后，它确实很快也能正常的工作。我同样对它开发的活跃程度感到印象深刻 - 这是一个正在快速改进的框架。但是活跃的开发有一个代价：文档有一些缺乏，而且新版本的Robolectric改变了一些老版本中的使用方法。另外，它不能模拟所有框架 - 例如应用间通信（IPC）- 因为它不是运行在真实的Android操作系统里。可以说在Android单元测试这个角度，收益会远远大于它的缺点。

**优点：**

* 快速
* 能访问模拟的Android框架
* 开发活跃

**缺点：**

* 不是真实的Android框架
* 不是一切都被模拟
* 缺少文档

## 总结
我赞成[Jason Sankey在StackOverflow关于单元测试层所说的](http://stackoverflow.com/questions/14949480/android-unit-test-case-automation-robolectric-library-vs-android-testing-framew/15020781#15020781)：使用纯单元测试，然后考虑Robolectric，最后考虑Android测试框架。

越往高层测试会变得更难和更慢，但是你有时会需要它。